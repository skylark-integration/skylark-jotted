/**
 * skylark-jotted - A version of jotted( html/css/js playground) that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jotted/
 * @license MIT
 */
define(["../util"],function(t){"use strict";return class{constructor(e,n){n=t.extend(n,{autoClear:!1});var o=`(${this.capture.toString()})();`,i=document.createElement("li");t.addClass(i,"jotted-nav-item jotted-nav-item-console"),i.innerHTML='<a href="#" data-jotted-type="console">JS Console</a>';var s=document.createElement("div");t.addClass(s,"jotted-pane jotted-pane-console"),s.innerHTML='\n      <div class="jotted-console-container">\n        <ul class="jotted-console-output"></ul>\n        <form class="jotted-console-input">\n          <input type="text">\n        </form>\n      </div>\n      <button class="jotted-button jotted-console-clear">Clear</button>\n    ',e.$container.appendChild(s),e.$container.querySelector(".jotted-nav").appendChild(i);var r=e.$container.querySelector(".jotted-console-container"),a=e.$container.querySelector(".jotted-console-output"),l=e.$container.querySelector(".jotted-console-input input"),c=e.$container.querySelector(".jotted-console-input"),h=e.$container.querySelector(".jotted-console-clear");c.addEventListener("submit",this.submit.bind(this)),l.addEventListener("keydown",this.history.bind(this)),h.addEventListener("click",this.clear.bind(this)),!0===n.autoClear&&e.on("change",this.autoClear.bind(this),29),e.on("change",this.change.bind(this),30),window.addEventListener("message",this.getMessage.bind(this)),this.$jottedContainer=e.$container,this.$container=r,this.$input=l,this.$output=a,this.history=[],this.historyIndex=0,this.logCaptureSnippet=o,this.contentCache={html:"",css:"",js:""},this.getIframe=this.getIframe.bind(this)}getIframe(){return this.$jottedContainer.querySelector(".jotted-pane-result iframe")}getMessage(t){if(t.source===this.getIframe().contentWindow){var e={};try{e=JSON.parse(t.data)}catch(t){}"jotted-console-log"===e.type&&this.log(e.message)}}autoClear(t,e){var n=t.content;"js"===t.type&&(n=n.replace(this.logCaptureSnippet,"")),!0!==t.forceRender&&this.contentCache[t.type]===n||this.clear(),this.contentCache[t.type]=n,e(null,t)}change(t,e){if("js"!==t.type)return e(null,t);-1===t.content.indexOf(this.logCaptureSnippet)&&(t.content=`${this.logCaptureSnippet}${t.content}`),e(null,t)}capture(){void 0!==window.console&&void 0!==window.console.log||(window.console={log:function(){}});var t=Function.prototype.bind.call(window.console.log,window.console);window.console.log=function(){[].slice.call(arguments).forEach(function(t){window.parent.postMessage(JSON.stringify({type:"jotted-console-log",message:t}),"*")}),t.apply(t,arguments)}}log(e="",n){var o=document.createElement("li");t.addClass(o,"jotted-console-log"),void 0!==n&&t.addClass(o,`jotted-console-log-${n}`),o.innerHTML=e,this.$output.appendChild(o)}submit(t){var e=this.$input.value.trim();if(""===e)return t.preventDefault();this.history.push(e),this.historyIndex=this.history.length,this.log(e,"history"),0!==e.indexOf("return")&&(e="return "+e);try{var n=this.getIframe().contentWindow.eval(`(function() {${e}})()`);this.log(n)}catch(t){this.log(t,"error")}this.$input.value="",this.$container.scrollTop=this.$container.scrollHeight,t.preventDefault()}clear(){this.$output.innerHTML=""}history(t){var e=!1,n=this.$input.selectionStart;38===t.keyCode&&0!==this.historyIndex&&0===n&&(this.historyIndex--,e=!0),40===t.keyCode&&this.historyIndex!==this.history.length-1&&n===this.$input.value.length&&(this.historyIndex++,e=!0),e&&(this.$input.value=this.history[this.historyIndex])}}});
//# sourceMappingURL=../sourcemaps/plugins/console.js.map
